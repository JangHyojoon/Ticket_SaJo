<!doctype html>
<html  lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<!-- Basic Page Needs -->
        <meta charset="utf-8">
        <title>AMovie - Booking step 3</title>
        <meta name="description" content="A Template by Gozha.net">
        <meta name="keywords" content="HTML, CSS, JavaScript">
        <meta name="author" content="Gozha.net">
    
    <!-- Mobile Specific Metas-->
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta content="telephone=no" name="format-detection">
    
    <!-- Fonts -->
        <!-- Font awesome - icon font -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
        <!-- Roboto -->
        <link href='http://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
    
    <!-- Stylesheets -->

        <!-- Mobile menu -->
        <link href="css/gozha-nav.css" rel="stylesheet" />
        <!-- Select -->
        <link href="css/external/jquery.selectbox.css" rel="stylesheet" />
    
        <!-- Custom -->
        <link href="css/style.css?v=1" rel="stylesheet" />

        <!-- Modernizr --> 
        <script src="js/external/modernizr.custom.js"></script>
        
        <!-- Ajax -->
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script>
			$(document).ready(function(){
			 
			 		
		 		//버튼 클릭
				$('#book3btn').click(function(){
					$('.book3').attr({
						'method':'post',
						'action':'book3impl'
					});
					$('.book3').submit();
					
				
				});
				
			
			
				
			 		
			});
				
				</script>
</head>


<script>


</script>

<script>

    function totalPrice(price) {
    	var coupon = $("#selectCoupon option:selected").val();
    	var coupon_id = $("#selectCoupon option:selected").attr('id');
    	var real_price = price;//쿠폰 적용 전 금액
    	var sale_price = coupon; // 할인금액 
    	var total_price = 0;// 쿠폰 적용 후 금액
    	var coupon_cid;
    	
    	if(coupon != "선택"){// 쿠폰 적용했을 경우 실행 
        	total_price = real_price - sale_price;
        	if(total_price < 0 ){// 할인 금액이 할인전 금액보다 클 경우 0으로 출력 
        		total_price = 0;
        	}
        	coupon_cid = coupon_id.split(' ',2);// coupon cid 의 형태에서 cid만 추출하기 위해 사용 
        	
    	}else{// 쿠폰을 아무것도 적용하지 않았을 경우 실행 
    		total_price = price;
    	}

    	//alert('coupon_id : ' + coupon_id);
    	$("#totalPrice").text(total_price);// 쿠폰 적용 금액을 text() 에 표시 
    	$("#totalprice").val(total_price);// form-input 에 있는 totalprice 
    	$("#selectcid").val(coupon_cid[1]);// form-input 에 있는 cid - 쿠폰의 id를 넘겨서 결제시 mycoupon에 있는 해당 쿠폰의 used필드를 false로, udate를 현재시간으로 설정  
    	

    }

</script>

 
<body th:if="${session.user != null}">
        <!-- Main content -->
        <section class="container">
            <div class="order-container">
             
            </div>
                <div class="order-step-area">
                    <div class="order-step first--step order-step--disable ">1. 영화 선택</div>
                    <div class="order-step second--step order-step--disable">2. 좌석 선택</div>
                    <div class="order-step third--step">3. 결제</div>
                </div>
                
                
		
          
               
                    <h2 class="page-heading">예매정보</h2>
                 <div>
	                 <div class="film-images col-lg-3"  th:id="${sv.mid} ? ${sv.mid}" >
					 	<img alt='' src="images/movie/movie-sample1.jpg" th:src="@{'images/movie/'+${sv.posterimg1}}" style="width:260px; height:400px; margin:10px;justify-content: center;">
					 </div>
                     <ul class="book-result col-lg-8" style="display: block;">
                        <li class="book-result__item col-sm-3">영화</li><li class="book-result__item"> <span class="book-result__count booking-ticket" th:text="${dsv.title}">영화</span></li>
                        <li class="book-result__item col-sm-3">날짜</li><li class="book-result__item"> <span class="book-result__count booking-price" th:text="${dsv.sdate}">날짜</span></li>
                        <li class="book-result__item col-sm-3">상영관</li><li class="book-result__item"> <span class="book-result__count booking-ticket"th:text="${dsv.tid}">상영관</span></li>
                                      
                        <li class="book-result__item col-sm-3">시작시간</li><li class="book-result__item"> <span class="book-result__count booking-ticket"th:text="${dsv.starttime}">시작시간</span></li>
                        <li class="book-result__item col-sm-3">끝나는시간</li><li class="book-result__item"> <span class="book-result__count booking-ticket" th:text="${dsv.endtime}">끝나는시간</span></li>
                        <li class="book-result__item col-sm-3">좌석</li><li class="book-result__item"> <span class="book-result__count booking-ticket" th:each="s:${seatlist}"th:text="${s}">좌석</span></li>
                        <li class="book-result__item col-sm-3">적립금</li><li class="book-result__item"> <input type="number" name='point' th:value="${cust.point}"></li>
                        <li class="book-result__item col-sm-3">사용할 쿠폰</li>	<li class="book-result__item">
	                        <select th:onchange="totalPrice([[${price}]])" id="selectCoupon" class="book-result__count booking-ticket"  >
								<option value="선택">선택</option>
								<option th:each="mycoupon,index : ${mycouponlist}"
									th:value="${mycoupon?.sale}" th:id="'coupon '+${mycoupon.id}"
									th:utext="${mycoupon?.text}+'( '+${mycoupon?.sale}+'원 )'"></option>
							</select>
                        </li>
                    </ul>
                 </div> 
                 
                     
                  <ul class="book-result col-lg-8" style="display: block;margin-top:30px;">
                                <li class="book-result__item col-sm-3">최종 금액: </li><li class="book-result__item"> <span class="book-result__count booking-cost" id="totalPrice" th:text="${price}+'원'">가격</span></li>
        		  </ul>
        		  
                   
					<form class="book3">
						<input type='hidden' name='sid' th:value="${dsv.sid}">
						<input type='hidden' name='mcnt' th:value="${dsv.mcnt}">
				        <input type='hidden' name='title' th:value="${dsv.title}">
				        <input type='hidden' name='price' th:value="${price}">
				        <input type='hidden' name='seatlist' th:value="${seatlist}">
						<input type='hidden' name='sdate' th:value="${dsv.sdate}">
						<input type='hidden' name='uid' th:value="${session.user.id}">
						<input type='hidden' name='totalprice' id="totalprice" th:value="${price}">
						<input type='hidden' name='cid' id="selectcid">
						
					
					</form>
                    



                
                
                
               

            
			
        </section>
        
 			
        <div class="clearfix"></div>

        <div class="booking-pagination">
                <a href="book2.html" class="booking-pagination__prev">
                    <p class="arrow__text arrow--prev">이전 페이지</p>
                    <span class="arrow__info">좌석 선택</span>
                </a>
                <a href="#" class="booking-pagination__next" id="book3btn">
                    <p class="arrow__text arrow--next">결제하기</p>
                    <span class="arrow__info">&nbsp;</span>
                </a>
        </div>
    
	<!-- JavaScript-->
        <!-- jQuery 3.1.1--> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/external/jquery-3.1.1.min.js"><\/script>')</script>
        <!-- Migrate --> 
        <script src="js/external/jquery-migrate-1.2.1.min.js"></script>
        <!-- Bootstrap 3--> 
        <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.2/js/bootstrap.min.js"></script>

        <!-- Mobile menu -->
        <script src="js/jquery.mobile.menu.js"></script>
         <!-- Select -->
        <script src="js/external/jquery.selectbox-0.2.min.js"></script>

        <!-- Form element -->
        <script src="js/external/form-element.js"></script>
        <!-- Form validation -->
        <script src="js/form.js"></script>

        <!-- Custom -->
        <script src="js/custom.js"></script>

</body>
<body th:unless="${session.user != null}">
	<div class="wrapper">
	       <div class="error-wrapper">
	           <a href='/' class="logo logo--dark">
	               <img alt='logo' src="images/logo-dark.png">
	               <p class="slogan--dark">fun to search, fun to watch</p>
	           </a>
	
	           <div class="error">
	               <img alt='' src='images/error.png' class="error__image">
	               <h1 class="error__text">sorry, but page can’t be found</h1>
	               <a href="/" class="btn btn-md btn--warning">return to homepage</a>
	           </div>
	       </div>
	
	       <div class="copy-bottom">
	           <p class="copy">&copy; A.Movie, 2013. All rights reserved. Done by Olia Gozha</p>
	       </div>
	
	</div>
	</body>
</html>
