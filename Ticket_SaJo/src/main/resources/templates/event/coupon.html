
<!-- Basic Page Needs -->
<meta charset="utf-8">
<meta name="description" content="A Template by Gozha.net">
<meta name="keywords" content="HTML, CSS, JavaScript">
<meta name="author" content="Gozha.net">

<!-- Mobile Specific Metas-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="telephone=no" name="format-detection">

<!-- Fonts -->
<!-- Font awesome - icon font -->
<link
	href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
	rel="stylesheet">
<!-- Roboto -->
<link href='http://fonts.googleapis.com/css?family=Roboto:400,700'
	rel='stylesheet' type='text/css'>


<!-- Modernizr -->
<script src="js/external/modernizr.custom.js"></script>

<!-- <link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"> -->
	
 
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
	

<style>
a { text-decoration:none; }
.offer {
	background-color: #4c4145;
	overflow: hidden;
	display: block;
	text-align: center;
	min-height: 325px;
	padding: 0 25px;
	margin-bottom: 30px;
	-webkit-transition: 0.3s;
	-o-transition: 0.3s;
	transition: 0.3s;
	border-radius: 30px;
}


.offer:hover {
	background-color: #ffd564;
	text-decoration:none;
}


.offer--snow {
	background-image: url(../images/icons/snow-dark.svg);
}

.offer--users {
	background-image: url(../images/icons/users-dark.svg);
}

.offer--wizard {
	background-image: url(../images/icons/wizard-dark.svg);
}

.offer--smile {
	background-image: url(../images/icons/smile-dark.svg);
}

.offer--gift {
	background-image: url(../images/icons/gift-dark.svg);
}

.offer--snow:hover {
	background-image: url(../images/icons/snow-light.svg);
}

.offer--users:hover {
	background-image: url(../images/icons/users-light.svg);
}

.offer--wizard:hover {
	background-image: url(../images/icons/wizard-light.svg);
}

.offer--smile:hover {
	background-image: url(../images/icons/smile-light.svg);
}

.offer--gift:hover {
	background-image: url(../images/icons/gift-light.svg);
}

.offer {
	padding: 0 15px;
	min-height: 345px;
}

.offer {
	min-height: 350px;
}


@media (max-width: 560px) {
  .offers-wrap {
    width: 100%;
  }
 }

.search {
  position: relative;
  top: -2px;/* 수정  */
}
.search .search__field {/* 수정 */
  display: inline-block;
  width: 100%;
  padding: 9px 300px 9px 19px; /* 수정 */
  margin-top: 14px;
  line-height: 18px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 10px;
  border: solid 1px #dbdee1;
  background-color: #fff;
  color: #4c4145;
  font-size: 13px;
}

.search .search__button {
  position: absolute;
  border-radius: 10px;
  top: 16px;/* 수정 */
  right: 0;
  z-index: 3;
}
.search .sbHolder {/* 수정 */
  display: inline-block;
  position: absolute;
  border-radius: 10px;
  top: 15px;/* 수정 */
  right: 160px;/* 수정 */
  width: 130px;
  height: 35px;
  border: none;
  border-left: 1px solid #dbdee1;
  background-color: #fff;
}

.search .sbHolder .sbToggle {/* 수정 */
  top: 10px;
  right: 10px;
}
.search .sbHolder .sbOptions {
  width: 130px;
  top: 37px !important;
  border: none;
  border-radius: 10px;/* 수정 */
  padding: 14px 7px;
  z-index: 23;
  background-color: #4c4145;
  -webkit-box-shadow: 0 0 10px rgba(0, 0, 0, 0.16);
  -moz-box-shadow: 0 0 10px rgba(0, 0, 0, 0.16);
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.16);
}

</style>



<div class="wrapper">

	<!-- Search bar -->
<!-- 	<div class="search-wrapper">
		<div class="container container--add ">
			<form id='search-form' method='get' class="search">
				<input type="text" class="search__field" placeholder="Search">
				<select name="sorting_item" id="search-sort" class="search__sort"
					>
					<option th:each="coupon,index : ${couponList}"
						th:value="${index.index}+1"><span th:text="${coupon.name}">
						</span></option>
							<option value="2"  selected='selected'>By year</option>

				</select>
				<button class="btn btn-md btn--shine search__button" tabindex="0" id="couponSearch">search
					a Coupon</button>
			</form>
		</div>
	</div>
 -->
	<!-- Main content -->
	<section class="container" style="margin-top:50px;">
		<div class="col-sm-12">
			<h2 class="page-heading">진행중인 쿠폰 이벤트 !!</h2>

			<div class="offers-block">
				<p class="offer-place">여러가지 쿠폰을 적용해 더 저렴하게 구매해 보세요!</p>

				<div class="col-xs-6 col-sm-4 col-md-3 offers-wrap"
					th:each="coupon : ${couponList}">
					<a th:href="'#modal'+${coupon.id}"
						th:class="'offer offer--'+${coupon.icon}" data-toggle="modal">
						<div class="offer__head">
							<p class="offer__name" th:text="${coupon.name}">
								<br>
							</p>
							<span class="offer__datail" th:text="${coupon.sale}+'원'">
							</span>
						</div>
						<p class="offer__full" th:text="${coupon.text}"></p>
						<p class="offer__full"
							th:text="${#dates.format(coupon.sdate,'yyyy-MM-dd')}+' ~ '+${#dates.format(coupon.edate,'yyyy-MM-dd')}"></p>
						<p class="offer__full"  >
						<span th:if="${coupon.hascoupon == '1'}" th:text="${'보유중'}" style="color:gray"></span>
						<span th:unless="${coupon.hascoupon == '1'}" th:text="${'발급가능'}" style="color:white"></span>

						</p>
					</a>
				</div>

				<!-- 
				<div class="col-xs-6 col-sm-4 col-md-3 offers-wrap">
					<a href='#' class="offer offer--family">
						<div class="offer__head">
							<p class="offer__name">
								family <br> ticket
							</p>
						</div>
						<p class="offer__full">Everyone pays the child price!</p>
					</a>
				</div>

				<div class="col-xs-6 col-sm-4 col-md-3 offers-wrap">
					<a href='#' class="offer offer--day">
						<div class="offer__head">
							<p class="offer__name">
								super<br> tuesday
							</p>
						</div>
						<p class="offer__full">Up to 1/3 off adult tickets all day,
							sign up nowand claim your discount.</p>
					</a>
				</div>

				<div class="col-xs-6 col-sm-4 col-md-3 offers-wrap">
					<a href='#' class="offer offer--teen">
						<div class="offer__head">
							<p class="offer__name">
								teen<br> tickets
							</p>
						</div>
						<p class="offer__full">Aged 13 -18? Save up to 20% on the
							adult ticket price with our teen ticket.</p>
					</a>
				</div>

				<div class="col-xs-6 col-sm-4 col-md-3 offers-wrap">
					<a href='#' class="offer offer--gift">
						<div class="offer__head">
							<p class="offer__name">
								Christmas<br>
							</p>
							<span class="offer__datail">with <br> Odeon West End
							</span>
						</div>
						<p class="offer__full">Spread Christmas cheer with the perfect
							gift for everyone.</p>
					</a>
				</div> -->

			</div>

		</div>
	</section>

	<div class="clearfix"></div>

</div>

<!-- Modal -->
<div class="modal fade" th:id="modal+${coupon.id}" role="dialog"
	th:each="coupon : ${couponList}">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content text-center">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title" th:text="${coupon.name}+' Coupon 발급'">Modal Header</h4>
			</div>
			<div class="modal-body text-left">
				<p th:text="${coupon.name}+' 쿠폰을 발급받으시겠습니까??'"></p>
			</div>
			<div class="modal-footer">
                <button type="button" th:onclick="addcoupon([[${coupon.id}]],[[${session.user}]])" id="inputcoupon" class="btn btn-default">발급</button>
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- End Modal -->
<div class="modal fade" id="Loginerror" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content text-center">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Login Error!! </h4>
			</div>
			<div class="modal-body text-left">
				<p >로그인이 필요한 서비스 입니다. </p>
				<p >로그인 페이지로 이동하시겠습니까? </p>
			</div>
			
			<div class="modal-footer">
                <button type="button"  id="login_go" class="btn btn-default" th:onclick="logingo()">로그인</button>
				<button type="button" class="btn btn-default" data-dismiss="modal" th:onclick="coupongo()">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- End Modal -->


<!-- End Modal -->
<div class="modal fade" id="couponOk" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content text-center">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">쿠폰발급 성공!! </h4>
			</div>
			<div class="modal-body text-left">
				<p >쿠폰 발급에 성공했습니다. 이벤트에 참여해 주셔서 감사합니다. <i class="fa fa-smile-o"></i> </p>
			</div>
			
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal" th:onclick="couponOk_redirect()">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- End Modal -->
<!-- End Modal -->
<div class="modal fade" id="couponFail" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content text-center">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">쿠폰 발급 실패.. </h4>
			</div>
			<div class="modal-body text-left">
				<p > 쿠폰 발급에 실패했습니다.  </p>
				<p > 현재 가지고 있는 쿠폰이거나 사용했던 쿠폰입니다.   </p>
				<p > 다른 쿠폰 이벤트에 참여해주세요.  <i class="fa fa-meh-o"></i></p>
			</div>
			
			<div class="modal-footer">

				<button type="button" class="btn btn-default" data-dismiss="modal" th:onclick="coupongo()">Close</button>


			</div>
		</div>
	</div>
</div>
<!-- End Modal -->


<script>



function logingo(){
	$('#Loginerror').modal('hide');
	window.location.href ="/signin";
	
}
function coupongo(){
	$('.modal-backdrop').remove();
	//$('#'+name).modal('hide');
	
}
function couponOk_redirect(name){
	window.location.href ="/coupon";
	
}


function addcoupon(couponid, user) {
	if(user == null){// 유저 정보가 없을경우 실행 
		$('#Loginerror').modal('show'); 
		$('#modal'+couponid).modal('hide');
		
	}else{// 유저 정보가 있을경우 실행 
		$('#modal'+couponid).modal('hide');
		$('.modal-backdrop').remove();// 수정 
		userCouponCheck(couponid);
	}
}

function userCouponCheck(couponid){

 	$.ajax({
		url : 'userCouponCheck',
 	 	data: {'couponid':couponid},
		success : function(data) {// data 가 1이면 발급성공, 0이면 발급취소 
			keepcoupon(data);

		}
	});
}

function keepcoupon(data){
	if(data == "1"){// 발급 성공
		$('#couponOk').modal('show'); 
		
	}else if(data == "0"){// 발급 실패
		$('#couponFail').modal('show'); 
	}else{// 오류 났을 경우 
		alert("잘못된 접근입니다. ");
	}
	
}

</script>
